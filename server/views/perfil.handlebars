
<div class="sidebar-transacciones">
  <p class="side-list-title">MI PERFIL</p>
  <a href="/perfil">
    <button class="side-list">PERFIL</button>
  </a>
  <a href="/transacciones">
    <button class="side-list">HISTORIAL DE TRANSFERENCIAS</button>
  </a>
  <a href="/deposito">
    <button class="side-list">TRANSACCIONES</button>
  </a>
  {{#if isLoggedIn}}
  <form action="/logout" method="post" style="margin-top: auto;">
    <button class="side-list logout-button" type="submit">CERRAR SESIÓN</button>
  </form>
  {{/if}}
</div>

<div class="profile-page-container">
  <div class="profile-header">
    <h1 class="page-title">Mi Perfil</h1>
  </div>

  {{#if error}}
  <div class="error-message" style="background: rgba(220, 53, 69, 0.2); border: 1px solid #dc3545; color: #dc3545; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
    {{error}}
  </div>
  {{/if}}

  {{#if success}}
  <div class="success-message" style="background: rgba(40, 167, 69, 0.2); border: 1px solid #28a745; color: #28a745; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
    {{success}}
  </div>
  {{/if}}

  <div class="profile-content">
    <div class="profile-card">
      <div class="profile-avatar-section">
        <div class="imagen-perfil"></div>
        <div class="profile-balance">
          <span class="balance-label">Saldo Actual</span>
          <span class="balance-amount">${{saldo}}</span>
        </div>
      </div>

      <div class="profile-info-section">
        <form id="profileForm" method="POST" action="/editar-perfil">
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Nombre Completo</span>
              <span class="info-value" id="fullname-display">{{fullname}}</span>
              <input type="text" class="info-input" id="fullname-input" name="fullname" value="{{fullname}}" style="display: none;">
            </div>
            
            <div class="info-item">
              <span class="info-label">Nombre de Usuario</span>
              <span class="info-value" id="username-display">{{username}}</span>
              <input type="text" class="info-input" id="username-input" name="username" value="{{username}}" style="display: none;">
            </div>
            
            <div class="info-item">
              <span class="info-label">Correo Electrónico</span>
              <span class="info-value" id="email-display">{{email}}</span>
              <input type="email" class="info-input" id="email-input" name="email" value="{{email}}" style="display: none;">
            </div>
            
            <div class="info-item">
              <span class="info-label">Fecha de Nacimiento</span>
              <span class="info-value" id="birthDate-display">{{birthDate}}</span>
              <input type="date" class="info-input" id="birthDate-input" name="birthDate" value="{{birthDate}}" style="display: none;">
            </div>
            
            {{#if card_number}}
            <div class="info-item">
              <span class="info-label">Número de Tarjeta</span>
              <span class="info-value" id="card_number-display">{{card_number}}</span>
              <input type="text" class="info-input" id="card_number-input" name="card_number" value="{{card_number}}" style="display: none;">
            </div>
            {{/if}}
          </div>

          <div class="profile-actions">
            <button type="button" class="edit-profile-btn" id="editBtn">Editar Perfil</button>
            <button type="submit" class="save-profile-btn" id="saveBtn" style="display: none;">Guardar Cambios</button>
            <button type="button" class="cancel-edit-btn" id="cancelBtn" style="display: none;">Cancelar</button>
            <button class="change-password-btn" type="button" onclick="window.location.href='/cambiar-contrasena'">Cambiar Contraseña</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  const editBtn = document.getElementById('editBtn');
  const saveBtn = document.getElementById('saveBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  
  const fields = ['fullname', 'username', 'email', 'birthDate', 'card_number'];
  let originalValues = {};

  // Guardar valores originales
  fields.forEach(field => {
    const display = document.getElementById(`${field}-display`);
    if (display) {
      originalValues[field] = display.textContent;
    }
  });

  editBtn.addEventListener('click', () => {
    // Mostrar inputs y ocultar displays
    fields.forEach(field => {
      const display = document.getElementById(`${field}-display`);
      const input = document.getElementById(`${field}-input`);
      if (display && input) {
        display.style.display = 'none';
        input.style.display = 'block';
      }
    });

    // Cambiar botones
    editBtn.style.display = 'none';
    saveBtn.style.display = 'inline-block';
    cancelBtn.style.display = 'inline-block';
  });

  cancelBtn.addEventListener('click', () => {
    // Restaurar valores originales y volver a modo visualización
    fields.forEach(field => {
      const display = document.getElementById(`${field}-display`);
      const input = document.getElementById(`${field}-input`);
      if (display && input) {
        input.value = originalValues[field] || '';
        display.style.display = 'block';
        input.style.display = 'none';
      }
    });

    // Cambiar botones
    editBtn.style.display = 'inline-block';
    saveBtn.style.display = 'none';
    cancelBtn.style.display = 'none';
  });
</script>